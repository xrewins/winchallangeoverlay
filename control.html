<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Win Challenge Control</title>
<link rel="stylesheet" href="style.css">
</head>
<body class="control">

<h1>üéÆ Win Challenge Control</h1>

<!-- Overlay URL Generator -->
<div class="url-generator">
  <h3>üì° Overlay f√ºr OBS einrichten:</h3>
  <ol>
    <li>√Ñndere unten deine Games</li>
    <li>Klicke auf "Overlay URL generieren"</li>
    <li>Kopiere die URL und f√ºge sie in OBS als Browserquelle ein</li>
  </ol>
  <button onclick="generateOverlayURL()" class="generate-btn">
    üîó Overlay URL generieren
  </button>
  <div id="url-output" style="margin-top: 15px;"></div>
</div>

<hr style="margin: 20px 0; border-color: rgba(255,255,255,0.1);">

<!-- Game Management -->
<h3>üéØ Games verwalten:</h3>
<input id="name" placeholder="Game Name">
<input id="needed" type="number" placeholder="Wins ben√∂tigt">
<button onclick="addGame()">Game hinzuf√ºgen</button>

<div id="list"></div>

<script>
// GitHub Pages URL - BITTE ANPASSEN!
const GITHUB_PAGES_URL = "https://xrewins.github.io/winchallangeoverlay/";

// Daten laden und anzeigen
function load() {
  const data = JSON.parse(localStorage.getItem("winChallenge")) || [];
  const list = document.getElementById("list");
  list.innerHTML = "";

  data.forEach((g, i) => {
    const done = g.current >= g.needed;
    list.innerHTML += `
      <div class="control-card ${done ? 'done' : ''}">
        <div class="title">${g.name}</div>
        <div class="progress">${g.current}/${g.needed}</div>
        <div class="buttons">
          <button onclick="change(${i},-1)">‚ûñ</button>
          <button onclick="change(${i},1)">‚ûï</button>
          <button onclick="removeGame(${i})" class="delete-btn">üóëÔ∏è</button>
        </div>
      </div>
    `;
  });
}

// Game hinzuf√ºgen
function addGame() {
  const nameInput = document.getElementById("name");
  const neededInput = document.getElementById("needed");
  
  if (!nameInput.value.trim() || !neededInput.value) {
    alert("Bitte Game-Name und ben√∂tigte Wins eingeben!");
    return;
  }
  
  const data = JSON.parse(localStorage.getItem("winChallenge")) || [];
  data.push({
    name: nameInput.value.trim(),
    needed: Number(neededInput.value),
    current: 0
  });
  
  localStorage.setItem("winChallenge", JSON.stringify(data));
  
  // Felder leeren
  nameInput.value = "";
  neededInput.value = "";
  nameInput.focus();
  
  load();
  updateURLIfVisible();
}

// Wins √§ndern
function change(i, v) {
  const data = JSON.parse(localStorage.getItem("winChallenge"));
  if (!data[i]) return;
  
  data[i].current = Math.max(0, data[i].current + v);
  localStorage.setItem("winChallenge", JSON.stringify(data));
  load();
  updateURLIfVisible();
}

// Game entfernen
function removeGame(i) {
  if (!confirm("Game wirklich l√∂schen?")) return;
  
  const data = JSON.parse(localStorage.getItem("winChallenge"));
  data.splice(i, 1);
  localStorage.setItem("winChallenge", JSON.stringify(data));
  load();
  updateURLIfVisible();
}

// Overlay URL generieren
function generateOverlayURL() {
  const data = JSON.parse(localStorage.getItem("winChallenge")) || [];
  
  if (data.length === 0) {
    alert("‚ö†Ô∏è F√ºge zuerst Games hinzu!");
    return;
  }
  
  // JSON in URL-safe String umwandeln
  const jsonString = JSON.stringify(data);
  const encodedData = encodeURIComponent(jsonString);
  
  // URL zusammensetzen
  const overlayUrl = GITHUB_PAGES_URL + "?data=" + encodedData;
  
  // URL anzeigen
  const urlOutput = document.getElementById("url-output");
  urlOutput.innerHTML = `
    <div style="background: #1a1a1a; padding: 15px; border-radius: 10px; margin: 10px 0;">
      <p><strong>üìã Diese URL in OBS einf√ºgen:</strong></p>
      <input type="text" value="${overlayUrl}" 
             style="width: 100%; padding: 10px; margin: 10px 0; background: #2a2a2a; color: white; border: 1px solid #444; border-radius: 5px;" 
             readonly id="url-input">
      <button onclick="copyURL()" style="padding: 8px 15px; background: #00ff9c; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
        üìã URL kopieren
      </button>
      <button onclick="testOverlay()" style="padding: 8px 15px; background: #0099ff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-left: 10px;">
        üîç In neuem Tab testen
      </button>
    </div>
  `;
  
  console.log("Overlay URL generiert:", overlayUrl);
  console.log("Daten:", data);
}

// URL kopieren
function copyURL() {
  const urlInput = document.getElementById("url-input");
  if (!urlInput) return;
  
  urlInput.select();
  urlInput.setSelectionRange(0, 99999); // F√ºr Mobile
  
  try {
    navigator.clipboard.writeText(urlInput.value).then(() => {
      alert("‚úÖ URL kopiert! F√ºge sie in OBS als Browserquelle ein.");
    });
  } catch (err) {
    // Fallback f√ºr √§ltere Browser
    document.execCommand("copy");
    alert("‚úÖ URL kopiert! F√ºge sie in OBS als Browserquelle ein.");
  }
}

// Overlay testen
function testOverlay() {
  const urlInput = document.getElementById("url-input");
  if (!urlInput) return;
  
  window.open(urlInput.value, '_blank');
}

// URL automatisch aktualisieren wenn sie sichtbar ist
function updateURLIfVisible() {
  const urlInput = document.getElementById("url-input");
  if (urlInput) {
    // URL neu generieren wenn bereits eine angezeigt wird
    generateOverlayURL();
  }
}

// Initial laden
load();

// Tastatur-Shortcuts
document.addEventListener('keydown', function(e) {
  // Enter im Name-Feld f√ºgt Game hinzu
  if (e.target.id === 'name' && e.key === 'Enter') {
    addGame();
  }
});
</script>

</body>
</html>
